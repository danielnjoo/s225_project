---
title: "Prelim Project Look - GroupF"
author: "Jocelyn, Daniel"
date: "3/1/2018"
output:
  pdf_document:
    fig_height: 3
    fig_width: 5
  html_document:
    fig_height: 3
    fig_width: 5
  word_document:
    fig_height: 3
    fig_width: 5
---

### Project Title: Travel in Developed and Developing Countries

```{r, include = FALSE}
library(tidyverse)
require(mosaic)
require(NSM3)
require(readr)
require(Rfit)
```

## Data Summary

### Data Read-In:
```{r}
data <- read.csv("Data/final_data.csv") %>% .[2:ncol(.)]
data %>% dim()
data %>% head()
```

### Summary Command:
```{r}
summary(data)
```

## Data Codebook

- airline
- airline.ID
- source.airport
- source.airport.id 
- destination.apirport
- destination.airport.id
- codeshare ("Y" if codeshare, empty otherwise)
- stops ("0" for direct flight)
- equipment (3-letter codes for plane types generally used on the flight, seperated by spaces if more than one)
- source.airport.name
- source.country     
- destination.airport.name
- destination.country
- Country.Code.x          
- X2010.x:X2016.x (GDP each year from 2010 - 2016)
- developed.x
- growth10_11.x:growth15_16.x (GDP growth between two years from 2010 - 2016)
- avg_growth.x
- Country.Code.y  
- X2010.y:X2016.y (GDP each year from 2010 - 2016)
- developed.y 
- growth10_11.y:growth15_16.y (GDP growth between two years from 2010 - 2016)
- avg_growth.y

Please note that a variable name with a '.x' corresponds to the source country of the flight and a variable name with a '.y' correpsonds to the destination country of the flight. Additionally, `developed` is a categorical variable that indicates whether a country is developing or developed using the GDP cutoff of 10,490 dollars. This value is inflation adjusted from $12,000 today's dollars.

### Selected Variable Analysis

#### Countries

```{r}
data$source.country %>% unique() %>% length()
data$destination.country %>% unique() %>% length()
```

156 unique source and destination countries.

```{r}
length(which(data$developed.x==1))/nrow(data)
```

Of which 68% of the outbound countries are developed.

```{r}
length(which(data$developed.y==1))/nrow(data)
```

And 68% of the inbound countries are developed.


### Distributions

### GDP

```{r}
# Distribution of GDP:
data2 <- dplyr::select(data, X2010.x, X2011.x, X2012.x, X2013.x, X2014.x, X2015.x, X2016.x, Country.Code.x, developed.x)
data2 <- gather(data2, key = "year", value = "GDP", -Country.Code.x, -developed.x)

# GDP Each Year:
ggplot(data2, aes(x = GDP, color = year)) + geom_density()

# GDP by developed or developing:
ggplot(data2, aes(x = GDP, color = as.factor(developed.x))) + geom_density()
```

```{r}
# Distribution of GDP Growth:
data3 <- dplyr::select(data, growth10_11.x, growth11_12.x, growth12_13.x, growth13_14.x, growth14_15.x, growth15_16.x, Country.Code.x, developed.x)
data3 <- gather(data3, key = "year", value = "GDP_Growth", -Country.Code.x, -developed.x)

# GDP Growth Each Year:
ggplot(data3, aes(x = GDP_Growth, color = year)) + geom_density()

# GDP Growth by developed or developing:
ggplot(data3, aes(x = GDP_Growth, color = as.factor(developed.x))) + geom_density()

# Distribution of Average GDP Growth:
ggplot(data, aes(x = avg_growth.x)) + geom_density()
ggplot(data, aes(x = avg_growth.x, color = as.factor(developed.x))) + geom_density()
```


#### Outbound Flights

```{r}
data %>% group_by(source.country) %>% summarize(count=n())  %>% 
  ggplot(aes(count)) + geom_histogram() + xlab("number of outbound flights for a country")
```

```{r}
# Identify Extreme Points:
data %>% group_by(source.country) %>% summarize(count = n()) %>% 
  filter(count > 850) %>% arrange(count)
```


#### Inbound Flights

```{r}
data %>% group_by(destination.country) %>% summarize(count=n())  %>% 
  ggplot(aes(count)) + geom_histogram() + xlab("number of inbound flights for a country")
```

```{r}
# Identify Extreme Points:
data %>% group_by(destination.country) %>% summarize(count = n()) %>% 
  filter(count > 850) %>% arrange(count) # Same as above.
```


#### Developed vs Developing Countries Outbound Flights

```{r}
data %>% group_by(developed.x) %>% summarize(count=n()) %>% ggplot(aes(as.factor(developed.x),count)) + geom_bar(stat='identity') + xlab("developed (1) vs developing (0) countries") + ggtitle("outbound flights for developing vs developed countries")
```

## Analysis Plan

### SLR - Average Growth to predict flights:

#### Scatterplots of the variables:

```{r}
data %>% group_by(source.country, avg_growth.x) %>% summarize(count=n()) -> temp
```

```{r}
temp %>% ggplot(aes(avg_growth.x, count)) + geom_point() + geom_smooth(method = 'lm')
```

```{r}
temp2 <- temp %>% mutate(log_count = log(count))
ggplot(temp2, aes(x = avg_growth.x, y = log_count)) + geom_point() 
+ geom_smooth(method = 'lm')
```

```{r}
temp3 <- temp %>% mutate(sqrt_count = sqrt(count))
ggplot(temp3, aes(x = avg_growth.x, y = sqrt_count)) + geom_point() + 
  geom_smooth(method = 'lm')
```

#### Parametric Regression:

```{r}
p_mod <- lm(count ~ avg_growth.x, data = temp)
summary(p_mod)
```

```{r}
p_mod2 <- lm(log_count ~ avg_growth.x, data = temp2)
summary(p_mod2)
```

```{r}
p_mod3 <- lm(sqrt_count ~ avg_growth.x, data = temp3)
summary(p_mod3)
```

> None of the above are significant
> May be better described by a non-linear model

> Add developed into the model?

```{r}
data %>% group_by(source.country, avg_growth.x, developed.x) %>% summarize(count=n()) -> temp

# Growth + developed
d_mod <- lm(count ~ avg_growth.x + developed.x, data = temp)
summary(d_mod)

# Just Developed - Parallel Slopes Model:
d_mod2 <- lm(count ~ developed.x, data = temp)
summary(d_mod2)
```

> Developed with avg growth has p-value of .02, but is still sig at .05 (p-val of .0447) when used alone as a predictor.


#### Non-parametric Regression:

```{r}
np_mod <- rfit(count ~ avg_growth.x, data = temp)
summary(np_mod, overall = 'drop')
```

```{r}
np_mod2 <- rfit(log_count ~ avg_growth.x, data = temp2)
summary(np_mod2, overall = 'drop')
```

```{r}
np_mod3 <- rfit(sqrt_count ~ avg_growth.x, data = temp3)
summary(np_mod3, data = temp3)
```

> None significant. Try smoothing.


### Travel Increased in Recently Developed Countries?


### Travel Locations

